<div class="mc-flex">
  <mc-header title="เครื่องพร้อมเปิดเบอร์ใหม่">
    <div class="header-icon-left">
      <mc-header-icon src="assets/images/icon/icon-back.png" (iconClick)="onBack()"></mc-header-icon>
    </div>
    <div class="header-icon-right">
      <mc-header-icon src="assets/images/icon/icon-home.png" (iconClick)="onHome()"></mc-header-icon>
    </div>
  </mc-header>
  <div class="mc-flex-wrap">
    <mc-shopping-cart [shoppingCart]="shoppingCart"></mc-shopping-cart>
    <div class="mt-3">
      <mc-wizard [wizards]="wizards" active="1"></mc-wizard>
      <!-- ############################################## payment detail ##############################################  -->
      <div class="container-fluid">
        <div class="card mb-3">
          <div class="card-header bg-orange text-white rounded-top p-3">
            {{paymenDetail?.title}}
          </div>
          <div class="card-header text-light-green bg-transparent">
            <div class="row">
              <div class="col-12">
                {{paymenDetail?.header}}
                <span class="pull-right">฿ {{ paymenDetail?.price | number: '1.2-2' }}</span>
              </div>
              <div class="col-12" *ngIf="priceOption?.trade?.advancePay && priceOption?.trade?.advancePay?.installmentFlag === 'Y'">
                {{advancePaymenDetail?.header}}
                <span class="pull-right">฿ {{ advancePaymenDetail?.price | number: '1.2-2' }}</span>
              </div>
            </div>
          </div>

          <div class="card-body">
            <form [formGroup]="paymentForm">
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="payment-qrcode" value="qrcode" formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="payment-qrcode">
                    ชำระเงิน QR Code
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="เต็มจำนวน">
                </div>
              </div>
              <div class="form-group row" *ngIf="paymentForm.controls['paymentTypeRadio'].value === 'qrcode'">
                <div class="col-6 col-sm-3" *ngFor="let qrCode of qrCodes; let i = index" (click)="onSelectQRCode(qrCode)">
                  <div class="qr-lazy-load-image" [ngClass]="{'active': qrCode?.id === selectQRCode?.id}">
                    <mc-lazy-load-image [src]="qrCode?.imageUrl"></mc-lazy-load-image>
                  </div>
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="payment-credit" value="credit" formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="payment-credit">
                    ชำระเงินด้วยบัตรเครดิต
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <select id="inputState" class="form-control" disabled>
                    <option [selected]="paymentType === 'CA'">เต็มจำนวน</option>
                    <option [selected]="paymentType !== 'CA'">ผ่อนชำระ</option>
                  </select>
                </div>
              </div>
              <div class="form-group row" *ngIf="paymentForm.controls['paymentTypeRadio'].value === 'credit'">

                <div class="col-4 col-sm-2 mb-3" *ngFor="let bank of banks; let i = index" (click)="onSelectBank(bank)">
                  <div class="bank-lazy-load-image" [ngClass]="{'active': bank?.abb === selectBank?.abb}">
                    <mc-lazy-load-image [src]="bank?.imageUrl"></mc-lazy-load-image>
                  </div>
                </div>
                <div class="col-12 text-left mb-3" *ngIf="!selectBank">
                  <span class="text-pink">*กรุณาเลือธนาคาร</span>
                </div>
                <div class="row" *ngIf="priceOption?.discount &&
                priceOption?.discount?.specialType !== '' &&
                priceOption?.discount?.specialAmount &&
                priceOption?.discount?.specialAmount > 0">
                  <div *ngIf="priceOption?.discount?.specialType === 'P'">
                    โปรโมชั่นพิเศษลดเพิ่ม {{ priceOption?.discount?.specialAmount }} %
                  </div>
                  <div *ngIf="priceOption.discount.specialType === 'B'">
                    โปรโมชั่นพิเศษลดเพิ่ม {{ priceOption?.discount?.specialAmount }} บาท
                  </div>
                </div>
              </div>
              <div class="form-group row" *ngIf="(paymentType === 'CC') && installments && paymentForm.controls['paymentTypeRadio'].value === 'credit'">
                <div class="col-12 text-center mb-3">
                  <span class="text-pink">*กรุณาเลือกรูปแบบการชำระเงิน</span>
                </div>
                <div class="col-12 col-sm-4" *ngFor="let installment of installments; let i = index">
                  <input class="form-check-input" type="radio" name="installment" id="installment-month-{{ i }}" value="installment"
                    (click)="onSelectInstallment(installment)" [checked]="installment?.installmentMounth === selectBank?.installments?.installmentMounth && installment?.installmentPercentage === selectBank?.installments?.installmentPercentage">
                  <label class="form-check-label" for="installment-month-{{ i }}">
                    {{ installment?.installmentPercentage }}% {{ installment?.installmentMounth }} เดือน
                  </label>
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="payment-debit" value="debit" formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="payment-debit">
                    ชำระที่เคาน์เตอร์
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="เต็มจำนวน">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- ############################################## advance payment ##############################################  -->
      <div class="container-fluid" *ngIf="priceOption?.trade?.advancePay && priceOption?.trade?.advancePay?.amount !== 0 &&
      (priceOption?.trade?.advancePay?.installmentFlag === 'N' || priceOption?.trade?.advancePay?.installmentFlag === '')">
        <div class="card mb-3">
          <div class="card-header text-light-green bg-transparent">
            {{advancePaymenDetail.header}}
            <span class="pull-right">฿ {{ advancePaymenDetail.price | number: '1.2-2' }}</span>
          </div>
          <div class="card-body">
            <form [formGroup]="advancePaymentForm">
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="advance-payment-qrcode" value="qrcode"
                    formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="advance-payment-qrcode">
                    ชำระเงิน QR Code
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="เต็มจำนวน">
                </div>
              </div>
              <div class="form-group row" *ngIf="advancePaymentForm.controls['paymentTypeRadio'].value === 'qrcode'">
                <div class="col-6 col-sm-3" *ngFor="let qrCode of qrCodes; let i = index" (click)="onSelectQRCodeAdvancePay(qrCode)">
                  <div class="qr-lazy-load-image" [ngClass]="{'active': qrCode?.id === selectQRCodeAdvancePay?.id}">
                    <mc-lazy-load-image [src]="qrCode?.imageUrl"></mc-lazy-load-image>
                  </div>
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="advance-payment-credit" value="credit"
                    formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="advance-payment-credit">
                    ชำระเงินด้วยบัตรเครดิต
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <select id="inputState" class="form-control" disabled>
                    <option selected>เต็มจำนวน</option>
                    <option>ผ่อนชำระ</option>
                  </select>
                </div>
              </div>
              <div class="form-group row" *ngIf="advancePaymentForm.controls['paymentTypeRadio'].value === 'credit'">

                <div class="col-4 col-sm-2 mb-3" *ngFor="let bank of banks; let i = index" (click)="onSelectBankAdvancePay(bank)">
                  <div class="bank-lazy-load-image" [ngClass]="{'active': bank?.abb === selectBankAdvancePay?.abb}">
                    <mc-lazy-load-image [src]="bank?.imageUrl"></mc-lazy-load-image>
                  </div>
                </div>
                <div class="col-12 text-left mb-3" *ngIf="!selectBankAdvancePay">
                  <span class="text-pink">*กรุณาเลือธนาคาร</span>
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <div class="col-12 col-sm-5">
                  <input class="form-check-input" type="radio" id="advance-payment-debit" value="debit" formControlName="paymentTypeRadio">
                  <label class="form-check-label" for="advance-payment-debit">
                    ชำระที่เคาน์เตอร์
                  </label>
                </div>
                <div class="col-12 col-sm-7">
                  <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="เต็มจำนวน">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <mc-receipt-info [receiptInfo]="receiptInfo"></mc-receipt-info>
    </div>
  </div>
  <mc-footer>
    {{checkPaymentFormValid()}}
    {{checkAdvancePaymentFormValid()}}
    <button class="btn btn-secondary" (click)="onBack()">BACK</button>
    <button class="btn btn-success" (click)="onNext()" [disabled]="!(checkPaymentFormValid() && checkAdvancePaymentFormValid())">NEXT</button>
  </mc-footer>
</div>